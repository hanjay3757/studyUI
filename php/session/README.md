# PHP 사용자 관리 시스템

PHP를 사용한 회원가입, 로그인, 메인페이지 시스템입니다.

## 📋 목차

- [기능](#기능)
- [설치 방법](#설치-방법)
- [파일 구조](#파일-구조)
- [보안 기능](#보안-기능)
- [사용 방법](#사용-방법)

## 🚀 기능

### 주요 기능

- **회원가입**: 사용자명, 이메일, 비밀번호, 이름 입력
- **로그인**: 사용자명 또는 이메일로 로그인
- **메인페이지**: 로그인 후 접근 가능한 대시보드
- **로그아웃**: 세션 종료 및 로그인 페이지로 이동

### 보안 기능

- **JWT 토큰 기반 인증**: 안전한 토큰 기반 인증 시스템
- **액세스 토큰 & 리프레시 토큰**: 보안성과 사용성 균형
- **HttpOnly 쿠키**: XSS 공격 방지를 위한 안전한 토큰 저장
- **토큰 자동 갱신**: 사용자 경험 향상을 위한 자동 토큰 갱신
- **비밀번호 해싱**: password_hash() 사용
- **입력 데이터 검증**: 모든 사용자 입력 검증 및 정리
- **SQL 인젝션 방지**: Prepared Statements 사용
- **XSS 방지**: htmlspecialchars() 사용

## 📦 설치 방법

### 1. 환경 요구사항

- PHP 7.4 이상
- MySQL 5.7 이상
- Apache/Nginx 웹서버

### 2. 데이터베이스 설정

```sql
-- MySQL에서 실행
source create_database.sql;
```

### 3. 설정 파일 수정

`config.php` 파일에서 데이터베이스 연결 정보를 수정하세요:

```php
$host = 'localhost';      // 데이터베이스 호스트
$dbname = 'user_system';  // 데이터베이스 이름
$username = 'root';       // 데이터베이스 사용자명
$password = '';           // 데이터베이스 비밀번호
```

### 4. 웹서버 설정

파일들을 웹서버의 문서 루트 디렉토리에 업로드하세요.

## 📁 파일 구조

```
session/
├── config.php              # 데이터베이스 연결 설정
├── functions.php           # 공통 함수들
├── JWT.php                 # JWT 토큰 관리 클래스
├── index.php              # 메인 진입점
├── register.php           # 회원가입 페이지
├── login.php              # 로그인 페이지
├── main.php               # 메인페이지 (대시보드)
├── logout.php             # 로그아웃 처리
├── refresh_token.php      # JWT 토큰 갱신 API
├── token_manager.js       # 클라이언트 토큰 관리 스크립트
├── create_database.sql    # 데이터베이스 생성 스크립트
├── README.md              # 프로젝트 설명서
├── start.php              # 기존 세션 테스트 파일
├── session.php            # 기존 세션 생성 파일
├── delete.php             # 기존 세션 삭제 파일
└── ini.php                # 기존 설정 파일
```

## 🔒 보안 기능

### 1. 비밀번호 보안

- `password_hash()` 함수로 비밀번호 해싱
- `password_verify()` 함수로 비밀번호 검증
- 비밀번호 강도 검사 (길이, 대소문자, 숫자 포함)

### 2. 입력 데이터 검증

- `sanitize_input()` 함수로 입력 데이터 정리
- 이메일 유효성 검사
- 사용자명 형식 검사
- XSS 방지를 위한 `htmlspecialchars()` 사용

### 3. JWT 토큰 보안

- **액세스 토큰**: 1시간 만료, API 요청 시 사용
- **리프레시 토큰**: 7일 만료, 액세스 토큰 갱신용
- **HttpOnly 쿠키**: XSS 공격 방지를 위한 안전한 저장
- **토큰 무효화**: 로그아웃 시 서버에서 토큰 무효화
- **자동 갱신**: 클라이언트에서 토큰 만료 시 자동 갱신

### 4. SQL 인젝션 방지

- PDO Prepared Statements 사용
- 매개변수 바인딩으로 SQL 인젝션 방지

### 5. 세션 보안 (하위 호환성)

- 세션 시작 시 보안 설정
- 로그인 상태 확인
- 세션 만료 처리

## 🎯 사용 방법

### 1. 회원가입

1. `register.php` 페이지 접속
2. 사용자명, 이메일, 이름, 비밀번호 입력
3. 비밀번호 확인 입력
4. 회원가입 버튼 클릭

### 2. 로그인

1. `login.php` 페이지 접속
2. 사용자명 또는 이메일 입력
3. 비밀번호 입력
4. 로그인 버튼 클릭

### 3. 메인페이지

- 로그인 성공 시 자동으로 이동
- 사용자 정보 표시
- 로그아웃 기능 제공

## 🔧 코드리뷰 포인트

### 1. 보안 관련

- **JWT 토큰 인증**: 안전한 토큰 기반 인증 시스템
- **액세스/리프레시 토큰**: 보안성과 사용성 균형
- **HttpOnly 쿠키**: XSS 공격 방지를 위한 안전한 토큰 저장
- **토큰 자동 갱신**: 사용자 경험 향상을 위한 자동 토큰 갱신
- **비밀번호 해싱**: `password_hash()` 사용으로 안전한 비밀번호 저장
- **입력 검증**: 모든 사용자 입력에 대한 검증 및 정리
- **SQL 인젝션 방지**: Prepared Statements 사용
- **XSS 방지**: 출력 시 `htmlspecialchars()` 사용

### 2. 코드 구조

- **모듈화**: 공통 함수들을 `functions.php`로 분리
- **설정 분리**: 데이터베이스 설정을 `config.php`로 분리
- **에러 처리**: try-catch 구문으로 예외 처리
- **코드 주석**: 각 함수와 주요 로직에 상세한 주석

### 3. 사용자 경험

- **반응형 디자인**: Bootstrap을 사용한 모바일 친화적 UI
- **에러 메시지**: 사용자 친화적인 에러 메시지 표시
- **성공 메시지**: 작업 완료 시 명확한 피드백
- **네비게이션**: 직관적인 메뉴 구조

### 4. 데이터베이스 설계

- **정규화**: 적절한 테이블 구조
- **인덱스**: 검색 성능을 위한 인덱스 설정
- **제약조건**: UNIQUE, NOT NULL 등 적절한 제약조건
- **타임스탬프**: 생성일, 수정일, 마지막 로그인 시간 기록

## 🐛 문제 해결

### 일반적인 문제들

1. **데이터베이스 연결 실패**

   - `config.php`의 데이터베이스 정보 확인
   - MySQL 서비스 실행 상태 확인

2. **세션 문제**

   - PHP 세션 설정 확인
   - 브라우저 쿠키 설정 확인

3. **권한 문제**
   - 파일 및 디렉토리 권한 확인
   - 웹서버 사용자 권한 확인

## 📝 라이선스

이 프로젝트는 교육 목적으로 제작되었습니다.

## 🤝 기여

버그 리포트나 기능 제안은 언제든 환영합니다!
