<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Supabase Edge Function Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        max-width: 800px;
        margin: 0 auto;
      }
      pre {
        background-color: #263238;
        color: #ffffff;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
        white-space: pre-wrap;
      }
      button {
        background-color: #4caf50;
        color: white;
        padding: 12px 20px;
        font-size: 16px;
        cursor: pointer;
        border: none;
        border-radius: 4px;
        margin: 10px 5px;
      }
      button:hover {
        background-color: #45a049;
      }
      .loading {
        color: #666;
        font-style: italic;
      }
      .error {
        color: #f44336;
        background-color: #ffebee;
        padding: 10px;
        border-radius: 4px;
        border-left: 4px solid #f44336;
      }
      .success {
        color: #4caf50;
        background-color: #e8f5e8;
        padding: 10px;
        border-radius: 4px;
        border-left: 4px solid #4caf50;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸš€ Supabase Edge Function Test</h1>

      <div>
        <button id="fetchButton">POST ìš”ì²­ (ê¸°ë³¸ ë°ì´í„°)</button>
        <button id="fetchButton2">POST ìš”ì²­ (ë‹¤ë¥¸ ë°ì´í„°)</button>
        <button id="getButton">GET ìš”ì²­ í…ŒìŠ¤íŠ¸</button>
        <button id="clearButton">ê²°ê³¼ ì§€ìš°ê¸°</button>
      </div>

      <h2>Response:</h2>
      <div id="responseDisplay"></div>
    </div>

    <script>
      const API_URL =
        "https://ycudxvwvnvuphaqihbwz.supabase.co/functions/v1/get-test-items";
      const AUTH_TOKEN =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InljdWR4dnd2bnZ1cGhhcWloYnd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MDQ4NzUsImV4cCI6MjA2NzE4MDg3NX0.kXr42tMkiSgCczffd0py-PWj-bodj-FZQQmzN5KCo18";

      function showResult(data, type = "success") {
        const responseDisplay = document.getElementById("responseDisplay");

        if (type === "loading") {
          responseDisplay.innerHTML =
            '<div class="loading">API í˜¸ì¶œ ì¤‘...</div>';
          return;
        }

        const className = type === "error" ? "error" : "success";
        const emoji = type === "error" ? "âŒ" : "âœ…";

        responseDisplay.innerHTML = `
                <div class="${className}">
                    <h4>${emoji} ${type === "error" ? "ì˜¤ë¥˜" : "ì„±ê³µ"}</h4>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
      }

      // POST ìš”ì²­ (ê¸°ë³¸ ë°ì´í„°)
      document
        .getElementById("fetchButton")
        .addEventListener("click", async () => {
          showResult(null, "loading");

          try {
            const response = await fetch(API_URL, {
              method: "POST", // âœ… ìˆ˜ì •: POST ë©”ì„œë“œ ëª…ì‹œ
              headers: {
                Authorization: `Bearer ${AUTH_TOKEN}`,
                "Content-Type": "application/json", // âœ… ìˆ˜ì •: Content-Type ì¶”ê°€
              },
              body: JSON.stringify({
                // âœ… ìˆ˜ì •: Request Body ì¶”ê°€
                id: 123,
                name: "test-item",
                enabled: true,
                tags: ["test", "example"],
                data: {
                  key: "value",
                },
              }),
            });

            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            showResult(data, "success");
          } catch (error) {
            showResult(
              {
                error: error.message,
                details: "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” CORS ë¬¸ì œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
              },
              "error"
            );
            console.error("Error fetching data:", error);
          }
        });

      // POST ìš”ì²­ (ë‹¤ë¥¸ ë°ì´í„°)
      document
        .getElementById("fetchButton2")
        .addEventListener("click", async () => {
          showResult(null, "loading");

          try {
            const response = await fetch(API_URL, {
              method: "POST",
              headers: {
                Authorization: `Bearer ${AUTH_TOKEN}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                id: 456,
                name: "another-test",
                enabled: false,
                tags: ["production", "important"],
                data: {
                  type: "experiment",
                  version: "1.0.0",
                },
              }),
            });

            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            showResult(data, "success");
          } catch (error) {
            showResult(
              {
                error: error.message,
                details: "POST ìš”ì²­ ì‹¤íŒ¨",
              },
              "error"
            );
            console.error("Error fetching data:", error);
          }
        });

      // GET ìš”ì²­ í…ŒìŠ¤íŠ¸
      document
        .getElementById("getButton")
        .addEventListener("click", async () => {
          showResult(null, "loading");

          try {
            const response = await fetch(API_URL, {
              method: "GET", // GET ìš”ì²­ë„ í…ŒìŠ¤íŠ¸
              headers: {
                Authorization: `Bearer ${AUTH_TOKEN}`,
              },
            });

            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            showResult(data, "success");
          } catch (error) {
            showResult(
              {
                error: error.message,
                details:
                  "GET ìš”ì²­ ì‹¤íŒ¨ - Edge Functionì´ GETì„ ì§€ì›í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
              },
              "error"
            );
            console.error("Error fetching data:", error);
          }
        });

      // ê²°ê³¼ ì§€ìš°ê¸°
      document.getElementById("clearButton").addEventListener("click", () => {
        document.getElementById("responseDisplay").innerHTML = "";
      });

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë©”ì‹œì§€
      window.onload = function () {
        document.getElementById("responseDisplay").innerHTML =
          '<div class="success"><h4>ì¤€ë¹„ë¨</h4><p>ìœ„ ë²„íŠ¼ì„ í´ë¦­í•´ì„œ APIë¥¼ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”!</p></div>';
      };
    </script>
  </body>
</html>
